<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #000; color: #fff; font-family: 'Courier New', Courier, monospace;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; margin: 0; overflow: hidden;
            background-size: cover; background-position: center;
        }
        #terminal { width: 80%; font-size: 1.5em; }
        .line { white-space: pre-wrap; }
        .cursor { display: inline-block; width: 10px; height: 1.2em; background-color: #fff; animation: blink 1s step-end infinite; }
        @keyframes blink { from, to { background-color: transparent; } 50% { background-color: #fff; } }
        #birthday-scene { display: none; width: 100%; height: 100%; position: relative; animation: sceneFadeIn 2s forwards; }
        @keyframes sceneFadeIn { from { opacity: 0; } to { opacity: 1; } }
        #scene-container {
            width: 100%; height: 100%; position: relative;
            display: flex; justify-content: center; align-items: center;
            perspective: 1200px;
        }
        
        /* ===== TEXTURE ADDED HERE ===== */
        #table-trapezoid {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 25vh;
            /* Layers a semi-transparent color gradient over your image texture */
            background:
                linear-gradient(to top, rgba(107, 36, 38, 0.6), rgba(138, 48, 50, 0.4)),
                url('assets/mat.jpeg');
            background-size: cover; /* Ensures the texture covers the whole area */
            background-position: center; /* Centers the texture nicely */
            clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
            z-index: 1; opacity: 0; animation: fadeIn 2s 0.5s forwards;
        }
        #cake-model {
            width: 350px; height: 350px; position: absolute; bottom: 8vh; left: 50%;
            transform: translateX(-50%) translateY(-150vh) scale(0.8);
            opacity: 0; z-index: 10; will-change: transform, opacity;
            transition: transform 1.5s ease-out, opacity 1.5s ease-out;
            --model-viewer-background-color: transparent;
        }
        #cake-model.dropped { transform: translateX(-50%) translateY(0) scale(0.85); opacity: 1; }
        .photo-container { position: absolute; opacity: 0; animation: fadeIn 1s forwards; z-index: 5; will-change: opacity; }
        .photo {
            width: 120px; height: 150px; border: 15px solid #6b2426; border-bottom-width: 30px;
            background-color: #fff; background-size: cover; background-position: center;
            box-shadow: 5px 10px 20px rgba(0,0,0,0.4);
        }
        #photo1-container .photo { background-image: url('assets/photo1.jpg'); }
        #photo2-container .photo { background-image: url('assets/photo2.jpg'); }
        #photo1-container { bottom: 2vh; left: 20vw; transform: rotate(-15deg); animation-delay: 2s; }
        #photo2-container { bottom: 4vh; left: 65vw; transform: rotate(5deg); animation-delay: 2.2s; }
        #note-container {
            position: absolute; bottom: 3vh; right: 35vw;
            width: 75px; height: 50px; z-index: 15;
            opacity: 0; animation: fadeIn 1s 3.5s forwards;
            will-change: opacity, transform; transform: rotate(8deg);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }
        #note-container.disappeared {
            opacity: 0;
            transform: rotate(8deg) scale(0.0);
        }
        #note-front img { width: 100%; height: 100%; cursor: pointer; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #qr-popup {
            position: fixed; top: 50%; left: 50%; padding: 15px;
            background-color: white; border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            z-index: 100; opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            pointer-events: none;
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
            will-change: opacity, transform;
        }
        #qr-popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        #qr-popup img { display: block; width: 150px; height: 200px; }
    </style>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
</head>
<body>

    <div id="terminal">
        <div id="output"></div>
        <div class="cursor"></div>
    </div>

    <div id="birthday-scene">
        <div id="scene-container">
            <div id="table-trapezoid"></div>
            <model-viewer id="cake-model" src="assets/cake.glb" unlit="true" exposure="1.5" auto-rotate
                camera-controls camera-orbit="0deg 75deg 3m" camera-target="0 0.5m 0"
                shadow-intensity="1">
            </model-viewer>
            <div class="photo-container" id="photo1-container"><div class="photo"></div></div>
            <div class="photo-container" id="photo2-container"><div class="photo"></div></div>
           
            <div id="note-container">
                <div id="note-front">
                    <img src="assets/bday_card_front.png" loading="lazy" alt="Click for a surprise">
                </div>
            </div>
        </div>
    </div>
    
    <div id="qr-popup">
        <img src="assets/qr-code.jpg" alt="QR Code">
    </div>

<script>
    const terminalOutput = document.getElementById('output');
    const terminal = document.getElementById('terminal');
    const birthdayScene = document.getElementById('birthday-scene');
    const cakeModel = document.getElementById('cake-model');
    const noteContainer = document.getElementById('note-container');
    const qrPopup = document.getElementById('qr-popup');

    const terminalLines = [ "> MY HANDSOME ❤", "> Today is our second anniversary", "> so i made you this computer program", "> (づ￣ 3￣)づ" ];
    let termLine = 0, termChar = 0;
    function typeTerminal() { if (termLine < terminalLines.length) { if (termChar < terminalLines[termLine].length) { if (termChar === 0) { const lineDiv = document.createElement('div'); lineDiv.classList.add('line'); terminalOutput.appendChild(lineDiv); } terminalOutput.lastChild.textContent += terminalLines[termLine].charAt(termChar++); setTimeout(typeTerminal, 80); } else { termLine++; termChar = 0; setTimeout(typeTerminal, 400); } } else { setTimeout(showBirthdayScene, 1000); } }
    
    function showBirthdayScene() {
        terminal.style.display = 'none';
        birthdayScene.style.display = 'block';
        document.body.style.backgroundImage = "url('assets/bg.png')";
        setTimeout(() => { cakeModel.classList.add('dropped'); }, 1200);

        noteContainer.addEventListener('click', function() {
            noteContainer.classList.add('disappeared');
            qrPopup.classList.add('show');
        }, { once: true });
    }
    
    typeTerminal();
</script>

</body>
</html>